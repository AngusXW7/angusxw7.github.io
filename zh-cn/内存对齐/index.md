# 内存对齐

内存管理中很重要的一点，内存对齐！

<!--more-->

## 什么是内存对齐

首先我们知道每个数据都是有不同的大小的，可能是1,2,4,8 byte。而且每个数据元素也是按照他们定义的顺序一个一个放进内存的。大部分情况下数据的读取是以4为单位的，所以为了提高数据的读取速度，让数据不同的大小减少对数据读取速度的影响，我们开始使用内存对齐，并且可以用 #pragma pack(n) 来定义对齐系数。

从结构体存储的首地址开始，每个元素放置到内存中时，他们都会认为内存是按照自己的大小来划分的，因此元素放置的位置一定会在自己宽度的整数倍上开始，这就是所谓的内存对齐。

### 举个栗子

```
struct
{
    int x;
    char y;
}
```
当我问你们这个结构体占多大的时候，可能会有人不假思索的说出5 byte，但是实际上他占了8 byte;这时候就会问了，int占4 byte char 占 1 byte， 4+1=5啊，为什么会是8，这就是内存对齐所导致的了。

## 为什么要内存对齐

1. 平台原因： 不是所有的硬件平台都可以访问任意地址上的任意数据，所以为了更好的兼容性，我们要使用内存对齐；
2. 性能原因： 当处理器按照自己的访问长度来访问未对齐的内存的时候，处理器需要访问两次内存，而如果对齐了的话只需要访问一次。

## 内存对齐的规则

1. 基本类型对齐的n就是sizeof得到的值；
2. 数据成员对齐则是按照自身大小和 #pragma pack(n)中较小的那个进行；
3. 结构或者联合整体对齐规则 是按照最大数据成员长度和 #pragma pack(n)中较小的那个进行。

// 一般默认n=4;

